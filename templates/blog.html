<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{{ blog.meta.title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{ blog.meta.description }}">

    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300;1,400&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark-dimmed.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --font-ui: 'Inter', sans-serif;
            --font-body: 'Merriweather', serif;
            --font-code: 'JetBrains Mono', monospace;
        }

        body {
            font-family: var(--font-ui);
            background-color: #ffffff;
            color: #18181b;
            -webkit-font-smoothing: antialiased;
        }

        #progress-bar {
            width: 0%;
            transition: width 0.1s;
        }

        .prose {
            font-family: var(--font-body);
            color: #3f3f46;
            font-size: 1.125rem;
            line-height: 1.8;
        }

        .prose h1,
        .prose h2,
        .prose h3 {
            font-family: var(--font-ui);
            color: #111;
            margin-top: 2em;
            letter-spacing: -0.02em;
        }

        .prose a {
            color: #111;
            text-decoration: underline;
            text-decoration-thickness: 1px;
            text-underline-offset: 4px;
        }

        .prose a:hover {
            color: #2563eb;
        }

        .prose pre {
            background-color: #18181b; 
            font-family: var(--font-code);
            font-size: 0.9rem;
            margin: 0; 
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
        }

        .prose img {
            border-radius: 0.5rem;
        }

        .prose blockquote {
            border-left-color: #111;
            font-style: italic;
            color: #555;
        }
        
        .code-block-wrapper {
            margin-top: 1.5em;
            margin-bottom: 1.5em;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .code-block-header {
            background-color: #27272a;
            color: #a1a1aa;
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: var(--font-ui);
            font-size: 0.75rem;
            border-bottom: 1px solid #3f3f46;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col">

    <div class="fixed top-0 left-0 h-1 bg-black z-[60]" id="progress-bar"></div>

    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-zinc-100 transition-all duration-300">
        <div class="max-w-[1280px] mx-auto px-6 h-14 flex items-center justify-between">
            <a href="/" class="flex items-center gap-2 group">
                <span
                    class="font-bold text-base tracking-tight text-zinc-900 group-hover:text-zinc-600 transition-colors">{{ PlatformName }}</span>
            </a>

            <a href="#"
                class="text-xs font-semibold uppercase tracking-wider text-zinc-500 hover:text-black transition-colors border border-zinc-200 px-3 py-1.5 rounded-full hover:border-black">
                Subscribe
            </a>
        </div>
    </nav>

    <main class="flex-1 w-full max-w-[1280px] mx-auto px-6 py-12">

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 items-start">

            <div class="lg:col-span-8">

                <header class="mb-10 border-b border-zinc-100 pb-10">
                    <div
                        class="flex items-center gap-3 text-xs font-bold tracking-widest uppercase text-zinc-400 mb-6 font-sans">
                        <span class="text-blue-600">Blog</span>
                        <span>•</span>
                        <span>{{ blog.meta.updated_at.strftime("%B %d, %Y") }}</span>
                        <span>•</span>
                        <span id="readTime">... min read</span>
                    </div>

                    <h1
                        class="font-sans text-4xl md:text-5xl lg:text-6xl font-extrabold text-zinc-900 leading-[1.1] mb-8 tracking-tight">
                        {{ blog.meta.title }}
                    </h1>

                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 rounded-full bg-zinc-100 flex items-center justify-center border border-zinc-200">
                            <i data-lucide="user" class="w-5 h-5 text-zinc-400"></i>
                        </div>
                        <div class="text-left">
                            <p class="font-sans text-sm font-semibold text-zinc-900">{{ blog.meta.author.name }}</p>
                            <p class="font-sans text-xs text-zinc-500">Author</p>
                        </div>
                    </div>
                </header>

                <article id="content" class="prose prose-zinc prose-lg max-w-none">
                </article>

                <div class="lg:hidden mt-16 pt-10 border-t border-zinc-100">
                    <h3 class="font-bold text-lg mb-6">Read Next</h3>
                    {% if blogs %}
                    <div class="flex flex-col gap-6">
                        {% for b in blogs %}
                        <a href="/blog/{{ b.slug }}" class="group">
                            <h4 class="font-bold text-zinc-900 group-hover:text-blue-600 transition">{{ b.title }}</h4>
                            <p class="text-sm text-zinc-500 line-clamp-2 mt-1">{{ b.description }}</p>
                        </a>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <aside class="hidden lg:block lg:col-span-4 sticky top-24 pl-8 border-l border-zinc-100">
                <div class="mb-8 flex items-center gap-2">
                    <i data-lucide="trending-up" class="w-4 h-4 text-zinc-400"></i>
                    <h3 class="text-xs font-bold uppercase tracking-widest text-zinc-400">More Stories</h3>
                </div>

                {% if blogs %}
                <div class="flex flex-col gap-8">
                    {% for b in blogs %}
                    <a href="/blog/{{ b.slug }}" class="group block">
                        <article class="flex flex-col h-full">
                            <span class="text-[10px] font-bold text-zinc-400 uppercase tracking-wider mb-2">
                                {{ b.updated_at.strftime("%b %d") }}
                            </span>

                            <h4
                                class="font-sans text-base font-bold text-zinc-900 leading-snug mb-2 group-hover:text-zinc-600 transition-colors">
                                {{ b.title }}
                            </h4>

                            <p class="font-serif text-xs text-zinc-500 line-clamp-3 mb-3 leading-relaxed">
                                {{ b.description }}
                            </p>

                            <div
                                class="flex items-center text-xs font-semibold text-zinc-900 opacity-0 group-hover:opacity-100 transition-opacity -translate-x-2 group-hover:translate-x-0 duration-300">
                                Read <i data-lucide="arrow-right" class="w-3 h-3 ml-1"></i>
                            </div>
                        </article>
                    </a>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-zinc-400 text-sm italic">No other stories available.</div>
                {% endif %}

                <div class="mt-12 p-6 bg-zinc-50 rounded-xl border border-zinc-100">
                    <h4 class="font-bold text-sm text-zinc-900 mb-2">Subscribe to newsletter</h4>
                    <p class="text-xs text-zinc-500 mb-4">Get the latest posts delivered right to your inbox.</p>
                    <button
                        class="w-full bg-black text-white text-xs font-bold py-2 rounded-lg hover:bg-zinc-800 transition">Subscribe</button>
                </div>
            </aside>

        </div>
    </main>

    <footer class="border-t border-zinc-100 bg-white py-12 mt-12">
        <div class="max-w-[1280px] mx-auto px-6 flex flex-col items-center justify-center gap-4">
            <p class="text-sm text-zinc-400">&copy; 2025 {{ PlatformName }}.</p>
        </div>
    </footer>

    <script>
        // 1. Render Markdown
        // Showing error but its ohk as this is jinja template
        const MARKDOWN_CONTENT = {{ blog.content | tojson }};
        const contentContainer = document.getElementById('content');

        marked.use({ breaks: true, gfm: true });

        if (contentContainer && MARKDOWN_CONTENT) {
            contentContainer.innerHTML = marked.parse(MARKDOWN_CONTENT);

            contentContainer.querySelectorAll('pre code').forEach((el) => {
                hljs.highlightElement(el);
                
                const pre = el.parentElement;

                let language = 'Code';
                el.classList.forEach(cls => {
                    if (cls.startsWith('language-')) {
                        language = cls.replace('language-', '');
                    }
                });

                const wrapper = document.createElement('div');
                wrapper.className = 'code-block-wrapper';

                const header = document.createElement('div');
                header.className = 'code-block-header';
                
                
                header.innerHTML = `
                    <span class="font-mono uppercase font-bold text-xs tracking-wider">${language}</span>
                    <button class="copy-btn flex items-center gap-1.5 hover:text-white transition-colors text-xs font-medium">
                        <i data-lucide="copy" class="w-3.5 h-3.5"></i>
                        <span>Copy</span>
                    </button>
                `;

                pre.parentNode.insertBefore(wrapper, pre);
                
                wrapper.appendChild(header);
                wrapper.appendChild(pre);

                const btn = header.querySelector('.copy-btn');
                btn.addEventListener('click', () => {
                    const codeText = el.innerText;
                    
                    navigator.clipboard.writeText(codeText).then(() => {
                        btn.innerHTML = `<i data-lucide="check" class="w-3.5 h-3.5 text-green-500"></i><span class="text-green-500">Copied!</span>`;
                        lucide.createIcons(); 
                        
                        setTimeout(() => {
                            btn.innerHTML = `<i data-lucide="copy" class="w-3.5 h-3.5"></i><span>Copy</span>`;
                            lucide.createIcons();
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy: ', err);
                    });
                });
            });

            MathJax.typesetPromise();
        }

        lucide.createIcons();

        // 2. Read Time
        const text = contentContainer.innerText;
        const words = text.trim().split(/\s+/).length;
        const time = Math.ceil(words / 225);
        document.getElementById('readTime').innerText = `${time} min read`;

        // 3. Scroll Progress
        window.addEventListener('scroll', () => {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById("progress-bar").style.width = scrolled + "%";
        });
    </script>
</body>

</html>